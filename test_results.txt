
> fastrack-driving-school-lms@1.0.0 test
> vitest videoQuestionFunctions.test.js


[7m[1m[34m DEV [39m[22m[27m [34mv1.6.1[39m [90mc:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System[39m

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if user not authenticated[22m[39m
{"authenticated":false,"dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstderr[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if user not authenticated[22m[39m
{"dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"ERROR","message":"Error: Unauthenticated request: No auth and no data.authToken\n    at entryFromArgs (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\node_modules\\firebase-functions\\lib\\logger\\index.js:120:13)\n    at Object.error (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\node_modules\\firebase-functions\\lib\\logger\\index.js:109:8)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\videoQuestionFunctions.js:30:16\n    at Function.run (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\node_modules\\firebase-functions\\lib\\common\\onInit.js:28:10)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:63:40\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if userId missing[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if lessonId missing[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if courseId missing[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if questionId missing[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if selectedAnswer missing[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if userId does not match authenticated user[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if question not found[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstderr[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould throw error if question not found[22m[39m
{"severity":"ERROR","message":"Error checking video question answer: HttpsError: Question not found\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\videoQuestionFunctions.js:92:15\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:189:9\n    at runTest (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:781:11)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7\n    at withEnv (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5) {\n  code: 'not-found',\n  details: undefined,\n  httpErrorCode: { canonicalName: 'NOT_FOUND', status: 404 }\n}"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould return correct answer is true when answer matches[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould return correct answer is false when answer does not match[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould log audit event when answer is checked[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould include explanation when provided[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mcheckVideoQuestionAnswer[2m > [22m[2mshould not include explanation when not provided[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstderr[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mgetVideoQuestion[2m > [22m[2mshould handle database errors[22m[39m
{"severity":"ERROR","message":"Error getting video question: Error: Database error\n    at Object.<anonymous> (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:613:41)\n    at Object.mockCall (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/spy/dist/index.js:50:17)\n    at Object.spy (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/tinyspy/dist/index.js:42:80)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\videoQuestionFunctions.js:162:10\n    at Function.run (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\node_modules\\firebase-functions\\lib\\common\\onInit.js:28:10)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:620:32\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)"}

[90mstderr[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mrecordVideoQuestionResponse[2m > [22m[2mshould handle database errors[22m[39m
{"severity":"ERROR","message":"Error recording video question response: Error: Database error\n    at Object.<anonymous> (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:907:41)\n    at Object.mockCall (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/spy/dist/index.js:50:17)\n    at Object.spy (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/tinyspy/dist/index.js:42:80)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\videoQuestionFunctions.js:216:10\n    at Function.run (c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\node_modules\\firebase-functions\\lib\\common\\onInit.js:28:10)\n    at c:\\Users\\Cole\\Documents\\Fastrack\\Fastrack-Learning_Management-System\\functions\\src\\compliance\\__tests__\\videoQuestionFunctions.test.js:921:43\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///C:/Users/Cole/Documents/Fastrack/Fastrack-Learning_Management-System/node_modules/@vitest/runner/dist/index.js:909:15)"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mtimeout handling[2m > [22m[2mshould handle slow database responses gracefully[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mtimeout handling[2m > [22m[2mshould timeout and throw error on extremely slow requests[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mduplicate submissions[2m > [22m[2mshould allow same user to submit different answers to same question[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mduplicate submissions[2m > [22m[2mshould prevent users from reviewing same answer twice in audit logs[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mduplicate submissions[2m > [22m[2mshould record each submission separately in audit logs[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould return null correctAnswer when not provided[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle missing question field gracefully[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle empty string correctAnswer[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle null explanation field[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle undefined correctAnswer in question data[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle case-sensitive answer comparison[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

[90mstdout[2m | functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22m[2mVideo Question Functions[2m > [22m[2mTask 2.1: Cloud Function Integration Testing[2m > [22m[2mmalformed question data[2m > [22m[2mshould handle answers with whitespace[22m[39m
{"authenticated":true,"uid":"user-123","dataKeys":["userId","lessonId","courseId","questionId","selectedAnswer"],"severity":"INFO","message":"checkVideoQuestionAnswer called"}

 [33mâ¯[39m functions/src/compliance/__tests__/videoQuestionFunctions.test.js [2m ([22m[2m48 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 208[2mms[22m[39m
[31m   [33mâ¯[31m functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22mVideo Question Functions[2m > [22mTask 2.1: Cloud Function Integration Testing[2m > [22mmalformed question data[2m > [22mshould handle empty string correctAnswer[39m
[31m     â†’ Missing required parameters[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[1m[7m Failed Tests 1 [27m[22mâ¯â¯â¯â¯â¯â¯â¯[39m

[31m[1m[7m FAIL [27m[22m[39m functions/src/compliance/__tests__/videoQuestionFunctions.test.js[2m > [22mVideo Question Functions[2m > [22mTask 2.1: Cloud Function Integration Testing[2m > [22mmalformed question data[2m > [22mshould handle empty string correctAnswer
[31m[1mUnknown Error[22m: Missing required parameters[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ status: 'INVALID_ARGUMENT' }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m47 passed[39m[22m[90m (48)[39m
[2m   Start at [22m 15:36:47
[2m   Duration [22m 2.25s[2m (transform 117ms, setup 197ms, collect 468ms, tests 208ms, environment 702ms, prepare 323ms)[22m


[1m[7m[31m FAIL [39m[27m[22m[31m Tests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
