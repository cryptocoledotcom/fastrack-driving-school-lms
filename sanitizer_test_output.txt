
> fastrack-driving-school-lms@1.0.0 test
> react-scripts test sanitizer --watchAll=false

FAIL src/api/validators/__tests__/sanitizer.test.js
  Sanitizer
    sanitizeString()
      ‚àö should trim whitespace (1 ms)
      ‚àö should remove HTML-like brackets
      ‚àö should preserve normal text
      ‚àö should return non-string values unchanged (1 ms)
      ‚àö should handle empty strings
      ‚àö should handle mixed brackets
    sanitizeObject()
      √ó should sanitize string values in object (3 ms)
      √ó should handle nested objects (1 ms)
      ‚àö should handle arrays of strings (1 ms)
      ‚àö should preserve non-string values
      ‚àö should return non-object values unchanged (1 ms)
      ‚àö should handle empty objects
      ‚àö should not modify original object
    sanitizeArray()
      √ó should sanitize strings in array (1 ms)
      ‚àö should handle nested arrays
      √ó should handle objects in arrays
      ‚àö should preserve non-string values
      ‚àö should return non-array values unchanged
      ‚àö should handle empty arrays
    sanitizeEmail()
      ‚àö should sanitize and lowercase email
      √ó should remove HTML brackets
      ‚àö should handle standard emails (3 ms)
    sanitizeUrl()
      ‚àö should sanitize standard URLs
      ‚àö should reject javascript: protocol (3 ms)
      ‚àö should reject data: protocol with scripts (1 ms)
      ‚àö should allow safe data: URLs
      ‚àö should throw if not a string (1 ms)
      ‚àö should handle relative URLs
      ‚àö should remove HTML brackets from URL
    sanitizeHtml()
      ‚àö should remove script tags
      ‚àö should remove style tags
      ‚àö should remove all HTML tags (1 ms)
      ‚àö should handle self-closing tags
      ‚àö should return non-string unchanged
      ‚àö should handle HTML entities
    escapeHtml()
      ‚àö should escape HTML special characters
      ‚àö should escape full HTML string
      ‚àö should preserve normal text
      ‚àö should return non-string unchanged
      ‚àö should handle mixed content
    sanitizeAlphanumeric()
      √ó should remove special characters by default (1 ms)
      ‚àö should preserve allowed special characters
      ‚àö should preserve alphanumerics and spaces
      ‚àö should trim whitespace
      ‚àö should return non-string unchanged
      ‚àö should handle empty strings
    sanitizeForDatabase()
      √ó should combine sanitization and escaping (1 ms)
      ‚àö should handle HTML special characters
      ‚àö should be safe for storage (1 ms)
    sanitizeUsername()
      ‚àö should allow alphanumeric, dash, and underscore
      √ó should remove other special characters
      ‚àö should lowercase is preserved (not lowercased)
      ‚àö should trim whitespace
      ‚àö should return non-string unchanged
    sanitizePhoneNumber()
      √ó should allow digits, spaces, hyphens, parentheses
      ‚àö should remove other characters
      √ó should trim whitespace
      ‚àö should return non-string unchanged
    Security scenarios
      ‚àö should protect against XSS via object injection (1 ms)
      ‚àö should protect against SQL injection via strings
      √ó should protect against attribute injection
      ‚àö should handle unicode bypass attempts

  ‚óè Sanitizer ‚Ä∫ sanitizeObject() ‚Ä∫ should sanitize string values in object

    expect(received).toBe(expected) // Object.is equality

    Expected: "script alert /script"
    Received: "scriptalert/script"

    [0m [90m 44 |[39m       [36mconst[39m sanitized [33m=[39m [33mSanitizer[39m[33m.[39msanitizeObject(obj)[33m;[39m
     [90m 45 |[39m
    [31m[1m>[22m[39m[90m 46 |[39m       expect(sanitized[33m.[39mname)[33m.[39mtoBe([32m'script alert /script'[39m)[33m;[39m
     [90m    |[39m                              [31m[1m^[22m[39m
     [90m 47 |[39m     })[33m;[39m
     [90m 48 |[39m
     [90m 49 |[39m     it([32m'should handle nested objects'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:46:30)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeObject() ‚Ä∫ should handle nested objects

    expect(received).toBe(expected) // Object.is equality

    Expected: "dangerous bio /dangerous"
    Received: "dangerousbio/dangerous"

    [0m [90m 60 |[39m
     [90m 61 |[39m       expect(sanitized[33m.[39muser[33m.[39mname)[33m.[39mtoBe([32m'test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 62 |[39m       expect(sanitized[33m.[39muser[33m.[39mprofile[33m.[39mbio)[33m.[39mtoBe([32m'dangerous bio /dangerous'[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 63 |[39m     })[33m;[39m
     [90m 64 |[39m
     [90m 65 |[39m     it([32m'should handle arrays of strings'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:62:42)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeArray() ‚Ä∫ should sanitize strings in array

    expect(received).toBe(expected) // Object.is equality

    Expected: "script alert /script"
    Received: "scriptalert/script"

    [0m [90m 117 |[39m
     [90m 118 |[39m       expect(sanitized[[35m0[39m])[33m.[39mtoBe([32m'test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 119 |[39m       expect(sanitized[[35m1[39m])[33m.[39mtoBe([32m'script alert /script'[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 120 |[39m       expect(sanitized[[35m2[39m])[33m.[39mtoBe([32m'normal'[39m)[33m;[39m
     [90m 121 |[39m     })[33m;[39m
     [90m 122 |[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:119:28)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeArray() ‚Ä∫ should handle objects in arrays

    expect(received).toBe(expected) // Object.is equality

    Expected: "script alert /script"
    Received: "scriptalert/script"

    [0m [90m 139 |[39m
     [90m 140 |[39m       expect(sanitized[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 141 |[39m       expect(sanitized[[35m1[39m][33m.[39mvalue)[33m.[39mtoBe([32m'script alert /script'[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 142 |[39m     })[33m;[39m
     [90m 143 |[39m
     [90m 144 |[39m     it([32m'should preserve non-string values'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:141:34)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeEmail() ‚Ä∫ should remove HTML brackets

    expect(received).toBe(expected) // Object.is equality

    Expected: "script alert /script@example.com"
    Received: "scriptalert/script@example.com"

    [0m [90m 170 |[39m
     [90m 171 |[39m     it([32m'should remove HTML brackets'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 172 |[39m       expect([33mSanitizer[39m[33m.[39msanitizeEmail([32m'<script>alert</script>@example.com'[39m))[33m.[39mtoBe([32m'script alert /script@example.com'[39m)[33m;[39m
     [90m     |[39m                                                                             [31m[1m^[22m[39m
     [90m 173 |[39m     })[33m;[39m
     [90m 174 |[39m
     [90m 175 |[39m     it([32m'should handle standard emails'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:172:77)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeAlphanumeric() ‚Ä∫ should remove special characters by default

    expect(received).toBe(expected) // Object.is equality

    Expected: "helloworld com"
    Received: "helloworldcom"

    [0m [90m 305 |[39m   describe([32m'sanitizeAlphanumeric()'[39m[33m,[39m () [33m=>[39m {
     [90m 306 |[39m     it([32m'should remove special characters by default'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 307 |[39m       expect([33mSanitizer[39m[33m.[39msanitizeAlphanumeric([32m'hello@world.com'[39m))[33m.[39mtoBe([32m'helloworld com'[39m)[33m;[39m
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 308 |[39m       expect([33mSanitizer[39m[33m.[39msanitizeAlphanumeric([32m'test!@#$%'[39m))[33m.[39mtoBe([32m'test'[39m)[33m;[39m
     [90m 309 |[39m     })[33m;[39m
     [90m 310 |[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:307:65)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeForDatabase() ‚Ä∫ should combine sanitization and escaping

    expect(received).toContain(expected) // indexOf

    Expected substring: "&lt;"
    Received string:    "scriptalert(&quot;xss&quot;)&#x2F;script"

    [0m [90m 340 |[39m       expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'<'[39m)[33m;[39m
     [90m 341 |[39m       expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'>'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 342 |[39m       expect(sanitized)[33m.[39mtoContain([32m'&lt;'[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 343 |[39m       expect(sanitized)[33m.[39mtoContain([32m'&gt;'[39m)[33m;[39m
     [90m 344 |[39m     })[33m;[39m
     [90m 345 |[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:342:25)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizeUsername() ‚Ä∫ should remove other special characters

    expect(received).toBe(expected) // Object.is equality

    Expected: "johndoeexample"
    Received: "john.doe@example"

    [0m [90m 372 |[39m
     [90m 373 |[39m     it([32m'should remove other special characters'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 374 |[39m       expect([33mSanitizer[39m[33m.[39msanitizeUsername([32m'john.doe@example'[39m))[33m.[39mtoBe([32m'johndoeexample'[39m)[33m;[39m
     [90m     |[39m                                                              [31m[1m^[22m[39m
     [90m 375 |[39m       expect([33mSanitizer[39m[33m.[39msanitizeUsername([32m'john#doe$'[39m))[33m.[39mtoBe([32m'johndoe'[39m)[33m;[39m
     [90m 376 |[39m     })[33m;[39m
     [90m 377 |[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:374:62)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizePhoneNumber() ‚Ä∫ should allow digits, spaces, hyphens, parentheses

    expect(received).toBe(expected) // Object.is equality

    Expected: "(555) 123-4567"
    Received: "(555) 1234567"

    [0m [90m 391 |[39m   describe([32m'sanitizePhoneNumber()'[39m[33m,[39m () [33m=>[39m {
     [90m 392 |[39m     it([32m'should allow digits, spaces, hyphens, parentheses'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 393 |[39m       expect([33mSanitizer[39m[33m.[39msanitizePhoneNumber([32m'(555) 123-4567'[39m))[33m.[39mtoBe([32m'(555) 123-4567'[39m)[33m;[39m
     [90m     |[39m                                                               [31m[1m^[22m[39m
     [90m 394 |[39m       expect([33mSanitizer[39m[33m.[39msanitizePhoneNumber([32m'555-123-4567'[39m))[33m.[39mtoBe([32m'555-123-4567'[39m)[33m;[39m
     [90m 395 |[39m       expect([33mSanitizer[39m[33m.[39msanitizePhoneNumber([32m'+1 555 123 4567'[39m))[33m.[39mtoBe([32m'1 555 123 4567'[39m)[33m;[39m
     [90m 396 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:393:63)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ sanitizePhoneNumber() ‚Ä∫ should trim whitespace

    expect(received).toBe(expected) // Object.is equality

    Expected: "(555) 123-4567"
    Received: "(555) 1234567"

    [0m [90m 402 |[39m
     [90m 403 |[39m     it([32m'should trim whitespace'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 404 |[39m       expect([33mSanitizer[39m[33m.[39msanitizePhoneNumber([32m'  (555) 123-4567  '[39m))[33m.[39mtoBe([32m'(555) 123-4567'[39m)[33m;[39m
     [90m     |[39m                                                                   [31m[1m^[22m[39m
     [90m 405 |[39m     })[33m;[39m
     [90m 406 |[39m
     [90m 407 |[39m     it([32m'should return non-string unchanged'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:404:67)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  ‚óè Sanitizer ‚Ä∫ Security scenarios ‚Ä∫ should protect against attribute injection

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "onmouseover"
    Received string:        "&quot; onmouseover=&quot;alert(&#39;xss&#39;)&quot;"

    [0m [90m 436 |[39m       [36mconst[39m escaped [33m=[39m [33mSanitizer[39m[33m.[39mescapeHtml(input)[33m;[39m
     [90m 437 |[39m
    [31m[1m>[22m[39m[90m 438 |[39m       expect(escaped)[33m.[39mnot[33m.[39mtoContain([32m'onmouseover'[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 439 |[39m       expect(escaped)[33m.[39mtoContain([32m'&quot;'[39m)[33m;[39m
     [90m 440 |[39m     })[33m;[39m
     [90m 441 |[39m[0m

      at Object.<anonymous> (src/api/validators/__tests__/sanitizer.test.js:438:27)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

Test Suites: 1 failed, 1 total
Tests:       11 failed, 51 passed, 62 total
Snapshots:   0 total
Time:        1.321 s
Ran all test suites matching /sanitizer/i.
